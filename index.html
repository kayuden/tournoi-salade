<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tirage Tournoi Salade</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1, h2 { text-align: center; }
    .inputs { margin: 15px 0; display: flex; gap: 10px; }
    input, select, button { padding: 6px; font-size: 14px; }
    #players { margin: 15px 0; }
    .player { margin: 3px 0; }
    .round { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 8px; }
    .match { margin: 5px 0; }
    .competiteur { color: orange; font-weight: bold; }
    .noncompetiteur { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Tirage "Tournoi Salade"</h1>

  <div class="inputs">
    <input id="name" type="text" placeholder="Nom joueur">
    <select id="type">
      <option value="Competiteur">CompÃ©titeur ðŸŸ§</option>
      <option value="NonCompetiteur">Non CompÃ©titeur ðŸŸ©</option>
    </select>
    <button onclick="addPlayer()">Ajouter joueur</button>
  </div>

  <div id="players"></div>

  <button onclick="generateRounds()">ðŸŽ² GÃ©nÃ©rer les 4 tours</button>

  <div id="rounds"></div>

<script>
let players = [];
let partnerHistory = new Set();   // stocke les Ã©quipes
let encounterHistory = new Set(); // stocke toutes les rencontres (partenaires et adversaires)

function addPlayer() {
  const name = document.getElementById("name").value.trim();
  const type = document.getElementById("type").value;
  if (!name) return;
  players.push({name, type});
  document.getElementById("name").value = "";
  renderPlayers();
}

function renderPlayers() {
  const div = document.getElementById("players");
  div.innerHTML = "<h2>Joueurs inscrits :</h2>";
  players.forEach((p, i) => {
    div.innerHTML += `<div class="player">${i+1}. <span class="${p.type==='Competiteur'?'competiteur':'noncompetiteur'}">${p.name} (${p.type})</span></div>`;
  });
}

function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

function teamKey(a, b) {
  return [a, b].sort().join("-");
}

function matchKey(team1, team2) {
  return [...team1.map(x=>x.name), ...team2.map(x=>x.name)].sort().join("-");
}

function alreadyEncountered(a, b) {
  return encounterHistory.has(teamKey(a.name, b.name));
}

function registerMatch(team1, team2) {
  // enregistrer partenaires
  partnerHistory.add(teamKey(team1[0].name, team1[1].name));
  partnerHistory.add(teamKey(team2[0].name, team2[1].name));
  // enregistrer toutes les rencontres
  for (let p1 of team1) for (let p2 of team2) {
    encounterHistory.add(teamKey(p1.name, p2.name));
  }
}

function generateRounds() {
  if (players.length < 4) {
    alert("Ajoute au moins 4 joueurs !");
    return;
  }
  partnerHistory.clear();
  encounterHistory.clear();

  const roundsDiv = document.getElementById("rounds");
  roundsDiv.innerHTML = "";

  for (let round = 1; round <= 4; round++) {
    const type = (round % 2 === 1) ? "Mixte" : "HomogÃ¨ne";
    const roundDiv = document.createElement("div");
    roundDiv.className = "round";
    roundDiv.innerHTML = `<h2>Tour ${round} (${type})</h2>`;
    
    let pool = shuffle([...players]);
    let matches = [];
    let terrains = 0;

    while (pool.length >= 4 && terrains < 7) {
      let team1 = [], team2 = [];

      if (type === "Mixte") {
        let comp1 = pool.find(p => p.type === "Competiteur");
        let nonc1 = pool.find(p => p.type === "NonCompetiteur");
        if (!comp1 || !nonc1) break;
        team1 = [comp1, nonc1];
        pool.splice(pool.indexOf(comp1), 1);
        pool.splice(pool.indexOf(nonc1), 1);

        let comp2 = pool.find(p => p.type === "Competiteur");
        let nonc2 = pool.find(p => p.type === "NonCompetiteur");
        if (!comp2 || !nonc2) break;
        team2 = [comp2, nonc2];
        pool.splice(pool.indexOf(comp2), 1);
        pool.splice(pool.indexOf(nonc2), 1);

      } else { // homogÃ¨ne
        let group = pool[0].type;
        let t1 = pool.filter(p => p.type === group).slice(0,2);
        if (t1.length < 2) break;
        team1 = t1;
        team1.forEach(p => pool.splice(pool.indexOf(p), 1));

        if (pool.length < 2) break;
        group = pool[0].type;
        let t2 = pool.filter(p => p.type === group).slice(0,2);
        if (t2.length < 2) break;
        team2 = t2;
        team2.forEach(p => pool.splice(pool.indexOf(p), 1));
      }

      // Ã©viter les doublons d'Ã©quipe
      let t1key = teamKey(team1[0].name, team1[1].name);
      let t2key = teamKey(team2[0].name, team2[1].name);

      if (partnerHistory.has(t1key) || partnerHistory.has(t2key)) {
        // remettre les joueurs Ã  dispo si dÃ©jÃ  vus
        pool.push(...team1, ...team2);
        shuffle(pool);
        continue;
      }

      // Ã©viter les rencontres dÃ©jÃ  faites si possible
      let already = false;
      for (let p1 of team1) for (let p2 of team2) {
        if (alreadyEncountered(p1, p2)) already = true;
      }
      if (already && pool.length > 0) {
        pool.push(...team1, ...team2);
        shuffle(pool);
        continue;
      }

      registerMatch(team1, team2);
      matches.push([team1, team2]);
      terrains++;
    }

    matches.forEach((m,i) => {
      roundDiv.innerHTML += `<div class="match">Terrain ${i+1} : 
        <span class="${m[0][0].type==='Competiteur'?'competiteur':'noncompetiteur'}">${m[0][0].name}</span> +
        <span class="${m[0][1].type==='Competiteur'?'competiteur':'noncompetiteur'}">${m[0][1].name}</span>
        ðŸ†š
        <span class="${m[1][0].type==='Competiteur'?'competiteur':'noncompetiteur'}">${m[1][0].name}</span> +
        <span class="${m[1][1].type==='Competiteur'?'competiteur':'noncompetiteur'}">${m[1][1].name}</span>
      </div>`;
    });

    if (pool.length > 0) {
      roundDiv.innerHTML += `<p><em>Repos ou simples : ${pool.map(p => p.name).join(", ")}</em></p>`;
    }

    roundsDiv.appendChild(roundDiv);
  }
}
</script>
</body>
</html>
